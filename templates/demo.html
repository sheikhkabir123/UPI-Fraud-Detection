<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UPI Fraud Demo (Aesthetic)</title>

  <style>
    :root{
      --bg: #f7f9fb;
      --card: #ffffff;
      --muted: #7a8696;
      --accent: #0b79f7;
      --accent-2: #ff7a7a;
      --glass: rgba(255,255,255,0.6);
      --round: 14px;
      --shadow-1: 0 8px 24px rgba(16,24,40,0.06);
      --shadow-2: 0 2px 10px rgba(16,24,40,0.04);
    }
    html,body{height:100%}
    body{
      margin:0;
      min-height:100%;
      background:
        radial-gradient(1200px 400px at 10% 10%, rgba(11,121,247,0.04), transparent 8%),
        radial-gradient(900px 300px at 90% 90%, rgba(255,122,122,0.03), transparent 10%),
        var(--bg);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#0f1724;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
      box-sizing:border-box;
      display:flex;
      justify-content:center;
    }

    .wrap{max-width:980px;width:100%}
    header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    .logo{
      width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));
      display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;box-shadow:var(--shadow-2);
    }
    h1{font-size:20px;margin:0}
    p.lead{margin:6px 0 18px;color:var(--muted);font-size:0.95rem}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.8), var(--card));
      border-radius:var(--round);
      padding:22px;
      box-shadow:var(--shadow-1);
      border: 1px solid rgba(15,23,36,0.03);
    }

    form.grid{display:grid;grid-template-columns:1fr 380px;gap:22px;align-items:start}
    .left{min-width:0}
    .right{position:relative}

    label.field{display:block;margin-bottom:10px;font-size:.85rem;color:var(--muted)}
    input[type="text"], input[type="number"], input[type="datetime-local"], select{
      width:100%;padding:12px 14px;border-radius:10px;border:1px solid #e6eef8;background:linear-gradient(180deg,#fff,#fbfdff);
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.6);font-size:0.95rem;color:#071233;
      outline: none; transition: box-shadow .12s, border-color .12s, transform .06s;
    }
    input:focus, select:focus{box-shadow:0 6px 18px rgba(11,121,247,0.06);border-color:rgba(11,121,247,0.35)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1 / -1}

    .btn{
      display:inline-flex;gap:8px;align-items:center;justify-content:center;padding:10px 16px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent),#2aa7ff);color:white;font-weight:700;cursor:pointer;
      box-shadow:0 8px 18px rgba(11,121,247,0.12);transition:transform .08s, box-shadow .08s;
    }
    .btn:active{transform:translateY(1px)}
    .small{font-size:.82rem;color:var(--muted)}

    .result{
      margin-top:14px;background: linear-gradient(180deg, rgba(15,23,36,0.02), rgba(255,255,255,0.6));
      border-radius:12px;padding:14px;border:1px solid rgba(15,23,36,0.03);
    }
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:center}
    .stat-title{font-size:0.9rem;font-weight:700}
    .stat-sub{font-size:.82rem;color:var(--muted);margin-top:4px}

    .bar{height:16px;border-radius:8px;background:#eef4f9;overflow:hidden;margin-top:8px;border:1px solid rgba(15,23,36,0.02)}
    .bar>i{display:block;height:100%;background:linear-gradient(90deg,#ff6b6b,#ffd166);width:0%;transition:width .45s ease}

    .dramatic .bar>i{background:linear-gradient(90deg,#ff9f43,#ff3d71)}
    .model .bar>i{background:linear-gradient(90deg,#4ade80,#06b6d4)}

    ul.shap{margin-top:12px;padding-left:18px;line-height:1.6}
    ul.shap li{margin-bottom:6px}

    footer{margin-top:14px;color:var(--muted);font-size:.86rem;text-align:center}
    @media(max-width:980px){
      form.grid{grid-template-columns:1fr;gap:14px}
      .right{order:2}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">UPI</div>
      <div>
        <h1>UPI Fraud Detection — Demo</h1>
        <p class="lead">Real model probability + Demo Alert Score (exaggerated for presentation). Use both when you demo.</p>
      </div>
    </header>

    <div class="card">
      <form class="grid" onsubmit="return false;">
        <div class="left">
          <div class="row">
            <div>
              <label class="field">Transaction ID
                <input id="transaction_id" type="text" placeholder="tx_123" />
              </label>
            </div>
            <div>
              <label class="field">Timestamp
                <input id="timestamp" type="datetime-local" />
              </label>
            </div>
          </div>

          <label class="field">Amount (INR)
            <input id="amount" type="number" step="0.01" value="450" />
          </label>

          <div class="row">
            <div>
              <label class="field">Merchant Category
                <select id="merchant_category">
                  <option>food</option><option>grocery</option><option>travel</option><option>utilities</option><option>fashion</option><option>recharge</option>
                </select>
              </label>
            </div>
            <div>
              <label class="field">Device OS
                <select id="device_os"><option>android</option><option>ios</option></select>
              </label>
            </div>
          </div>

          <div class="row">
            <div>
              <label class="field">Channel
                <select id="channel"><option>app</option><option>scan_qr</option><option>intent</option><option>collect</option></select>
              </label>
            </div>
            <div>
              <label class="field">Auth Type
                <select id="auth_type"><option>pin</option><option>otp</option><option>biometric</option></select>
              </label>
            </div>
          </div>

          <div class="row">
            <div><label class="field">Payer ID<input id="payer_id" type="text" placeholder="payer_12" /></label></div>
            <div><label class="field">Payee ID<input id="payee_id" type="text" placeholder="payee_22" /></label></div>
          </div>

          <div class="row">
            <div><label class="field">Payer tx count in 24h<input id="payer_tx_count_24h" type="number" value="0" /></label></div>
            <div><label class="field">Prev tx amount 24h (sum)<input id="prev_tx_amount_24h" type="number" value="0" /></label></div>
          </div>

          <div class="row">
            <div>
              <label class="field">Is New Payee
                <select id="is_new_payee"><option value="1">Yes</option><option value="0">No</option></select>
              </label>
            </div>
            <div style="display:flex;align-items:end;justify-content:flex-end">
              <button class="btn" id="btnCheck" onclick="sendTx()">Check
                <svg width="14" height="14" style="opacity:.95" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 12h14" stroke="#fff" stroke-width="2" stroke-linecap="round"/><path d="M12 5l7 7-7 7" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </div>
        </div>

        <div class="right">
          <div class="result">
            <div class="two">
              <div class="model">
                <div class="stat-title">Model probability: <span id="prob">-</span></div>
                <div class="stat-sub">Real model output (used when explaining results)</div>
                <div class="bar"><i id="probbar" style="width:0%"></i></div>
              </div>

              <div class="dramatic">
                <div class="stat-title">Demo Alert Score: <span id="dramatic">-</span></div>
                <div class="stat-sub">Exaggerated score for presentation (visual only)</div>
                <div class="bar"><i id="dramaticbar" style="width:0%"></i></div>
              </div>
            </div>

            <div id="notes" style="margin-top:12px;font-weight:600;color:#273449"></div>

            <div style="margin-top:12px">
              <strong style="display:block;margin-bottom:8px">Top contributing features (SHAP)</strong>
              <ul id="shaplist" class="shap"><li class="small">No prediction yet</li></ul>
            </div>
          </div>
        </div>
      </form>
    </div>

    <footer>
      WE use demo alert score for dramatic effect
    </footer>
  </div>

  <script>
  /* keep same sendTx() and dramatic logic as before (unchanged behavior) */
  function computeDramatic(p, amount, prev_sum, payer_count, is_new_payee) {
    amount = Number(amount) || 0;
    prev_sum = Number(prev_sum) || 0;
    payer_count = Number(payer_count) || 0;
    is_new_payee = Number(is_new_payee) || 0;
    let ratio = amount / (prev_sum + 1);
    let m = 1 + Math.max(0, Math.log10(Math.max(1, ratio)) * 1.6);
    if (payer_count >= 10) m *= 1.8;
    else if (payer_count >= 5) m *= 1.3;
    if (is_new_payee) m *= 1.25;
    let d = p * m;
    if (amount > prev_sum && amount > 1000) {
      d = Math.max(d, Math.min(0.7, 0.03 + Math.log10(Math.min(amount, 1e18))/8));
    }
    d = Math.max(0, Math.min(1, d));
    return d;
  }

  async function sendTx(){
    const tx = {
      transaction_id: document.getElementById('transaction_id').value || 'tx_demo',
      timestamp: (()=>{
        const t = document.getElementById('timestamp').value;
        return t ? new Date(t).toISOString() : new Date().toISOString();
      })(),
      amount: parseFloat(document.getElementById('amount').value || 0),
      payer_id: document.getElementById('payer_id').value || 'payer_demo',
      payee_id: document.getElementById('payee_id').value || 'payee_demo',
      merchant_category: document.getElementById('merchant_category').value,
      device_os: document.getElementById('device_os').value,
      channel: document.getElementById('channel').value,
      auth_type: document.getElementById('auth_type').value,
      is_new_payee: parseInt(document.getElementById('is_new_payee').value || 0),
      payer_tx_count_24h: parseInt(document.getElementById('payer_tx_count_24h').value || 0),
      prev_tx_amount_24h: parseFloat(document.getElementById('prev_tx_amount_24h').value || 0)
    };

    document.getElementById('prob').textContent = 'loading...';
    document.getElementById('dramatic').textContent = 'loading...';
    document.getElementById('shaplist').innerHTML = '<li class="small">Computing...</li>';
    document.getElementById('notes').textContent = '';

    try {
      const res = await fetch('/api/predict', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(tx)});
      if (!res.ok) {
        const txt = await res.text();
        document.getElementById('notes').textContent = 'Server error: ' + txt;
        return;
      }
      const j = await res.json();
      const p = Number(j.fraud_probability || 0);
      const amount = Number(tx.amount || 0);
      const prev_sum = Number(tx.prev_tx_amount_24h || 0);
      const payer_count = Number(tx.payer_tx_count_24h || 0);
      const is_new = Number(tx.is_new_payee || 0);

      const d = computeDramatic(p, amount, prev_sum, payer_count, is_new);

      const pct = Math.round(p*10000)/100;
      const dpct = Math.round(d*10000)/100;

      document.getElementById('prob').textContent = pct + ' %';
      document.getElementById('probbar').style.width = Math.min(100,pct) + '%';

      document.getElementById('dramatic').textContent = dpct + ' %';
      document.getElementById('dramaticbar').style.width = Math.min(100,dpct) + '%';

      document.getElementById('notes').textContent = d > 0.25 ? 'High risk — recommend manual review' : d > 0.05 ? 'Medium risk — manual review recommended' : 'Low risk';

      const shapList = j.shap_top_features || [];
      const ul = document.getElementById('shaplist');
      if (shapList.length === 0) {
        ul.innerHTML = '<li class="small">No SHAP info returned</li>';
      } else {
        ul.innerHTML = shapList.map(it => `<li><strong>${it[0]}</strong>: ${Math.round(it[1]*1000)/1000}</li>`).join('');
      }
    } catch (err) {
      document.getElementById('notes').textContent = 'Request failed: ' + err.message;
    }
  }
  </script>
</body>
</html>
